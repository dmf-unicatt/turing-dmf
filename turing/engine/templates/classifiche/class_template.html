{% extends "base.html" %}
{% load static %}

{% block head %}
<script src="{% static "engine/js/client.js" %}"></script>
{% endblock %}

{% block css %}<link href="{% static 'engine/css/classifiche.css' %}" rel="stylesheet" type="text/css" >{% endblock %}

{% block content %}
{% if object.inizio is not null %}
{% block main %}{% endblock %}

<script>
document.updated = false;
document.addEventListener("updated", function(e) {
  document.updated = true;
});
$(document).ready(function() {
    var url = "{% url 'engine:status' object.pk %}";
    var client = new ClassificaClient(url, '{% block class_type %}{% endblock %}');
    client.init();
    {% if object.finished %}
    function integer_to_elapsed_time(seconds) {
        return new Date(seconds * 1000).toISOString().slice(11, 19);
    }
    function elapsed_time_to_integer(elapsed) {
        return elapsed.split(':').reduce((acc,time) => (60 * acc) + +time);
    }
    $("#myRange").on('input', function() {
        client.progress = this.value/1000;
        var durata = elapsed_time_to_integer("{{object.durata}}");
        elapsedTimeText.value = integer_to_elapsed_time(Math.floor(this.value / 1000 * durata));
    });
    $("#elapsedTimeText").on('blur', function() {
        var durata = elapsed_time_to_integer("{{object.durata}}");
        var elapsed_time = elapsed_time_to_integer(this.value);
        client.progress = elapsed_time/durata;
        myRange.value = Math.floor(elapsed_time/durata * 1000);
    });
    $("#play").click(function() {
        client.toggleReplay(this, "myRange")
    });

    {% else %}
    setInterval(function() {client.update()}, 3000);
    {% endif %}
});

</script>
{% else %}
<p>La classifica non Ã¨ disponibile prima dell'inizio della gara</p>
{% endif %}
{% endblock %}
